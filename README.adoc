
= Chats Admin Application

<<<

* <<Introduction,Introduction>>
* <<Implementation,Implementation>>
* <<ChatsAppBasics,Chats Application (App) Basics>>
* <<MainMenu, Main Menu Items>>
* <<ChatsDataEntities,Chats Data Entities>>
* <<Reports,Reports>>
* <<Administration,Administration>>
* <<Installation,Installation>>
* <<BackupAndRestore, Backup and Restore>>

[#Introduction]
== Introduction

To start a brief introduction, before getting into details below: The Lifeline Chats Program aims to
improve the well-being of elderly people in Tasmania by encouraging them to become more socially
engaged, through the organising of Chats [underline]#activities#.

This Chats Application (App) allows activities to be defined, and Chats [underline]#participants# to
be booked for future activities. A key aspect of such participation is that some participant's
transportation to and from the activity needs to be arranged,the Chats App enables that
administrative action.

An aspect of the Chats program is that some of the activities are regular. These are referred to as
[underline]#recurring activities#. A participant booked against a recurring activity intends to
participate in the individual (actual) activies of that recurring activity.

Social engagement is also assisted by means of regular telephone calls to Chats participants. Chats 
[underline]#calls# are scheduled and then completed when a telephone call is made. Often these calls
are made by a Chats [underline]#volunteer#.

There is also reporting functionality that the Chat App provides. 

[#Implementation]
== Implementation

This application has been developed for Lifeline Tasmania for data management in its 
https://www.lifeline.org.au/tasmania/chats-program[Chats] social engagement program. 

It is a application developed on the open-source http://isis.apache.org/[Apache Isis] Java 
web-application framework.

For installation details see <<Installation,below>>.

Version 2 of Chats App, based on a generic 
https://github.com/Stephen-Cameron-Data-Services/event-schedule[event-scheduling] app, 
is https://github.com/Stephen-Cameron-Data-Services/isis-chats/tree/chats2[available] but not as yet
in use.

[#ChatsAppBasics]
== Chats Application (App) Basics

The framework used to develop the Chats App is unusual in that it is auto-generates the user interface
from off the so-called 'domain model' design in Java object-oriented code. This sounds inflexible but
the thinking is that by improving the domain model this flows through to the user level. Once the 
distinctive features of how this happens are known it provides an efficient intuitive application for
users. So these are described now.

==== Main Menu Bar

The Chats App has a menu bar across the top with a single row of menu items.
Clicking on each of these gives a drop-down list of options each of which is described in sections 
below. These options in some cases are grouped into logical groupings via a dividing line.

On the left hand side of the menu bar is a small vertical bar (aqua blue in the following image). 
Clicking on this bar gives a list of bookmarks, which are links to entities that the user has prevously
visited in the current session.

The top-left 'Chats App' text is a hyperlink back to the 'home' page.

==== Page Body

Underneath the menu bar is the body of the page, where, usually, a specific Chats data 'entity' is 
displayed, each with an icon and title at the top, and then groups of data items and/or tables of 
child entities. Each such group and table also has a title at the top. The arrangement of items within
groups, and column orders within tables, is called the 'page layout'. The title of entities is commonly 
used for options lists of the kind of entity.

In searches, usually from a main menu option, a list is returned that fills the page body. Such lists may
be lists of entities, one per row, or, in the case of some reports each row represents a view across 
linked entities (e.g. Activity + Participant + Person + Attendance statistic).

==== Tabs

On some types of entities, tabs are used to aid navigation within an entity. The tab labels are 
diplayed as a row under the entity title, clicking on a tab label reveals a different subset of the
entities' data.
 
==== Navigation 

Navigation in Chats App is via links and icons (both are hyperlinks). A link is seen as underlined 
(light-blue) text. Specific icons are used to represent different kinds or 'types' of data entities so
providing a visual cue. Icon type hyperlinks are displayed on the left of all table rows to allow the
user to 'drill down' to get a full display of the child data entity (partially displayed in the row

==== Actions (buttons)

Another key concept in Chats App is that of [underline]#actions#. These are the grey 'buttons' that are
placed in relevant locations within the page layout. They usually have a small icon and a name to 
indicate their function. Hovering over an action button will display a message describing the action 
in more detail. Actions are the means for Chats App users to interact with an data entity.

==== Lists (collections)

Other than the use of distinctive icons for navigation into lists mentioned above, another key aspect of
lists is the action buttons that appear in the header bar of the list. 

The left-most (special) blue action button is always present and gives options to change the display of
the list. There are three standard display options: Table, Hide and Excel. Table is the standard view of
the list items, Hide simply removes the list items from view (Table brings them back), Excel presents
an action button 'Download as Excel' instead of the list, which if clicked then prompts to display or download 
the data as spreadsheet (.xlsx) file (just of what is in the table view so if not a complete enough export
a custom action is needed).
 
Other actions may be present and grey in colour. Add and Remove buttons are commonly present to add a new entity into 
the list and remove an entry from the list.

[#MainMenu]
== Main Menu Items

=== Menu Items and Option (Action) Lists

The menu items and their options are as follows:

* *Activities*
** *Create Recurring Activity* (<<ActivitiesMenu_CreateRecurringActivity, _details_>>)
** *Create One-off Activity* (<<ActivitiesMenu_CreateOneoffActivity, _details_>>)
** *Find Recurring Activity By Name*  (<<ActivitiesMenu_CreateOneoffActivity, _details_>>)
** *Find Activity By Name*  (<<Menu_FindActivityByName, _details_>>)
** *List All Recurring Activities*  (<<ActivitiesMenu_ListAllRecurringActivities, _details_>>)
** *List All Future Activities*  (<<ActivitiesMenu_ListAllFutureActivities, _details_>>)
** *List All Future Activities In Period*  (<<ActivitiesMenu_ListAllFutureActivitiesInPeriod, _details_>>)
* *Participants*
** *Create* (<<ParticipantsMenu_CreateParticipant, _details_>>)
** *Find Active Participant* (<<ParticipantsMenu_FindActiveParticipant, _details_>>)
** *Find By Surname* (<<ParticipantsMenu_FindBySurname, _details_>>)
** *Find Future Participation* (<<ParticipantsMenu_FindFutureParticipation, _details_>>)
** *List Active Participants* (<<ParticipantsParticipantsMenu_ListActiveParticipants, _details_>>)
** *List Exited Participants* (<<ParticipantsMenu_ListExitedParticipants, _details_>>)
** *List Inactive Participants* (<<ParticipantsMenu_ListInactiveParticipants, _details_>>)
** *List To Exit Participants* (<<ParticipantsMenu_ListToExitParticipants, _details_>>)
* *Volunteers*
** *Create*  (<<VolunteersMenu_CreateVolunteer, _details_>>)
** *Find Active Volunteer*  (<<VolunteersMenu_FindActiveVolunteer, _details_>>)
** *Find By Surname*  (<<VolunteersMenu_FindVolunteerBySurname, _details_>>)
** *List Active Volunteers*  (<<VolunteersMenu_ListActiveVolunteers, _details_>>)
** *List Inactive Volunteers*  (<<VolunteersMenu_ListInactiveVolunteers, _details_>>)
** *List To Exit Volunteers*  (<<VolunteersMenu_ListToExitVolunteers, _details_>>)
* *Attendances*
** *List Attendance Lists In Period*  (<<AttendancesMenu_ListAttendanceListsInPeriod, _details_>>)
** *Find Attendance Lists By Activity Name*  (<<AttendancesMenu_FindAttendanceListsByActivityName, _details_>>)
** *List Attendances In Period*  (<<AttendancesMenu_ListAttendancesInPeriod, _details_>>)
** *Find Attendances By Activity Name*  (<<AttendancesMenu_FindAttendancesByActivityName, _details_>>)
** *Find Attendances By Participant*  (<<AttendancesMenu_FindAttendancesByParticipant, _details_>>)
** *Remove Attend From List*  (<<AttendancesMenu_RemoveAttendFromList, _details_>>)
* *Calls*
** *Create* (<<CallsMenu_CreateCall, _details_>>)
** *Find Care Calls* (<<CallsMenu_FindCareCalls, _details_>>)
** *Find Reconnect Calls* (<<CallsMenu_FindReconnectCalls, _details_>>)
** *Find Survey Calls* (<<CallsMenu_FindSurveyCalls, _details_>>)
** *Find Scheduled Calls* (<<CallsMenu_FindScheduledCalls, _details_>>)
** *Find By Surname* (<<CallsMenu_FindBySurname, _details_>>)
** *List Calls In Period* (<<CallsMenu_ListCallsInPeriod, _details_>>)
** *List Daily Call Schedules For Volunteer* (<<CallsMenu_ListDailyCallSchedulesForVolunteer, _details_>>)
** *Create Calendar Day Call Schedule* (<<CallsMenu_CreateCalendarDayCallSchedule, _details_>>)
* *Reports*
** *Find Participants Call's And Attendances* (<<ReportsMenu_FindParticipantsCallsAndAttendances, _details_>>)
** *List Participant Involvement In Period* (<<ReportsMenu_ListParticipantInvolvementInPeriod, _details_>>)
** *List Participant Involvement In Period Totals* (<<ReportsMenu_ListParticipantInvolvementInPeriod Totals, _details_>>)
** *Find Volunteer's Times* (<<ReportsMenu_FindVolunteersTimes, _details_>>)
** *List Volunteer Involvement In Period* (<<ReportsMenu_ListVolunteerInvolvementInPeriod, _details_>>)
** *List Volunteer Involvement In Period Totals* (<<ReportsMenu_ListVolunteerInvolvementInPeriodTotals, _details_>>)
** *Find Most Inactive Participant* (<<ReportsMenu_FindMostInactiveParticipant, _details_>>)
** *Find Participant Activity* (<<ReportsMenu_FindParticipantActivity, _details_>>)
** *Mail Merge Data* (<<ReportsMenu_MailMergeData, _details_>>)
** *Find Participants With Birthday Between* (<<ReportsMenu_FindParticipantsWithBirthdayBetween, _details_>>)

=== Menu Option (Action) Descriptions

Descriptions of the menu options (actions) follow, with links to more detail.

[#ActivitiesMenu]
[#ActivitiesMenu_CreateRecurringActivity]
==== Activities -> Create Recurring Activity

To create a Recurring Activity the user is prompted to enter a name and a start date-time, optionally to enter a 
DEX Case Id. The name and start-date time are used to check for an existing activity with the same values in the database. 
The DEX Case Id will be created from the entered name if none is entered (by removing spaces and trimming to 25 characters).

The start date-time is not that of an actual activity, rather it is the seed date that is used for creation of the first 
'child' activity scheduled from the newly created parent recurring activity. 

The main reason to create a Recurring Activity parent is to maintain one list of Participants that gets shared with any child
activities scheduled off that parent. Each child's list of Participants includes those of its parent(<<RecurringActivity, more>>).

The region of the new Recurring Activity is the region assigned to the Chats App user.

[#ActivitiesMenu_CreateOneoffActivity]
==== Activities -> Create One-off Activity

To create a Recurring Activity the user is prompted to enter a name and a start date-time, optionally to enter a 
DEX Case Id. The name and start-date time are used to check for an existing activity with the same values in the database. 
The DEX Case Id will be created from the entered name if none is entered (by removing spaces and trimming to 25 characters).

The region of the new One-off Activity is the region assigned to the Chats App user.

[#<ActivitiesMenu_CreateOneoffActivity]
==== Activities -> Find Recurring Activity By Name

To find Recurring Activity 'parents' enter a name (or a partial name). This is a case sensitive search.  Only shows 
activities in the region of current Chats App user.

[#ActivitiesMenu_FindActivityByName]
==== Activities -> Find Activity By Name

To find activities enter a name (or partial name). This is a case sensitive search. The list returned will include all 
matching actual activities (i.e. One-off Activies (clear background icon) and Recurring Activity child activities
(yellow background icon)).  Only shows activities in the region of current Chats App user.

[#ActivitiesMenu_ListAllRecurringActivities]
==== Activities -> List All Recurring Activities

Generates a paged listing of all parent Recurring Activities for the region of the current Chats App user. 

[#ActivitiesMenu_ListAllFutureActivities]
==== Activities -> List All Future Activities

Generates a paged listing of all actual activities whose start date-time is later than the current date-time. Only 
shows such future activities in the region of the current Chats App user.

[#ActivitiesMenu_ListAllFutureActivitiesInPeriod]
==== Activities -> List All Future Activities In Period

Generates a paged listing of all actual activities whose start date-time lies within the Start and End date-times 
entered. Only shows the activities in the region of the current Chats App user.

[#ParticipantsMenu]
[#ParticipantsMenu_CreateParticipant]
==== Participants -> Create

To create a new <<Participant, Participant>> the user is prompted for the Chats Participant's first-name, surname, date-of-birth 
and sex. These data items are considered to uniquely identify a person (and are in fact the items used to calculate
the Statistical Linkage Key (SLK) used in the <<DEX reports>>).

[#ParticipantsMenu_FindActiveParticipant]
==== Participants -> Find Active Participant

This option gives a drop-down list of Participants having status 'ACTIVE'. This list is the standard list used throughout
the App, as Participants are hidden by setting the status to another value (more details <<ParticipantStatus, here>>). 
Only shows the Participants in the region of the current Chats App user.

[#ParticipantsMenu_FindBySurname]
==== Participants -> Find By Surname

This option gives another means to find an active Participant, so essentially the same as previous option but allows part of
a name to be entered. {Note: in Chats 2.0 this is redundant as auto-complete is added to all Participant listings}.

[#ParticipantsMenu_FindFutureParticipation]
==== Participants -> Find Future Participation

Provides a convenient way to get a list of all booked participation in future activities for a specific Participant. Useful if
the participant rings to enquire about this. This is the same list obtainable from the Participant but only includes future activities.

[#ParticipantsMenu_ListActiveParticipants]
==== Participants -> List Active Participants

Gives a paged listing of all the Participants, in the region of the current user, with status 'ACTIVE' (more details <<ParticipantStatus, here>>).

[#ParticipantsMenu_ListExitedParticipants]
==== Participants -> List Exited Participants

Gives a paged listing of all the Participants, in the region of the current user, with status 'EXITED' (more details <<ParticipantStatus, here>>).

[#ParticipantsMenu_ListInactiveParticipants]
==== Participants -> List Inactive Participants

Gives a paged listing of all the Participants, in the region of the current user, with status 'INACTIVE' (more details <<ParticipantStatus, here>>).

[#ParticipantsMenu_ListToExitParticipants]
==== Participants -> List To Exit Participants

Gives a paged listing of all the Participants, in the region of the current user, with status 'TO-EXIT' (more details <<ParticipantStatus, here>>).

[#VolunteersMenu]
=== Volunteers

[#VolunteersMenu_CreateVolunteer]
==== Volunteers -> Create

To create a new <<Volunteer, Volunteer>> the user is prompted for the Chats Volunteer's first-name, surname, date-of-birth 
and sex. These data items are considered to uniquely identify a person (and are in fact the items used to calculate
the Statistical Linkage Key (SLK) used in the <<DEX reports>>). 

[#VolunteersMenu_FindActiveVolunteer]
==== Volunteers -> Find Active Volunteer

This option gives a drop-down list of Volunteers having status 'ACTIVE'. This list is the standard list used throughout
the App, as Volunteers are hidden by setting the status to another value (more details <<VolunteerStatus, here>>). 
Only shows the Volunteers in the region of the current Chats App user.

[#VolunteersMenu_FindVolunteerBySurname]
==== Volunteers -> Find By Surname

This option gives another means to find an active Volunteer, so essentially the same as previous option but allows part of
a name to be entered. {Note: in Chats 2.0 this is redundant as auto-complete is added to all Volunteer listings}.

[#VolunteersMenu_ListActiveVolunteers]
==== Volunteers -> List Active Volunteers

Gives a paged listing of all the Volunteers, in the region of the current user, with status 'ACTIVE' (more details <<VolunteerStatus, here>>).

[#VolunteersMenu_ListInactiveVolunteers]
==== Volunteers -> List Inactive Volunteers

Gives a paged listing of all the Volunteers, in the region of the current user, with status 'INACTIVE' (more details <<VolunteerStatus, here>>).

[#VolunteersMenu_ListToExitVolunteers]
==== Volunteers -> List To Exit Volunteers

Gives a paged listing of all the Volunteers, in the region of the current user, with status 'TO-EXIT' (more details <<VolunteerStatus, here>>).

[#AttendancesMenu]
=== Attendances

[#AttendancesMenu_ListAttendanceListsInPeriod]
==== Attendances -> List Attendance Lists In Period

[#AttendancesMenu_FindAttendanceListsByActivityName]
==== Attendances -> Find Attendance Lists By Activity Name

[#AttendancesMenu_ListAttendancesInPeriod]
==== Attendances -> List Attendances In Period

[#AttendancesMenu_FindAttendancesByActivityName]
==== Attendances -> Find Attendances By Activity Name

[#AttendancesMenu_FindAttendancesByParticipant]
==== Attendances -> Find Attendances By Participant

[#AttendancesMenu_RemoveAttendFromList]
==== Attendances -> Remove Attend From List

[#CallsMenu]
=== Calls

[#CallsMenu_CreateCall]
==== Calls -> Create

[#CallsMenu_FindCareCalls]
==== Calls -> Find Care Calls

[#CallsMenu_FindReconnectCalls]
==== Calls -> Find Reconnect Calls

[#CallsMenu_FindSurveyCalls]
==== Calls -> Find Survey Calls

[#CallsMenu_FindScheduledCalls]
==== Calls -> Find Scheduled Calls

[#CallsMenu_FindBySurname]
==== Calls -> Find By Surname

[#CallsMenu_ListCallsInPeriod]
==== Calls -> List Calls In Period

[#CallsMenu_ListDailyCallSchedulesForVolunteer]
==== Calls -> List Daily Call Schedules For Volunteer

[#CallsMenu_CreateCalendarDayCallSchedule]
==== Calls -> Create Calendar Day Call Schedule

[#ReportsMenu]
=== Reports

[#ReportsMenu_FindParticipantsCallsAndAttendances]
==== Reports -> Find Participants Call's And Attendances

[#ReportsMenu_ListParticipantInvolvementInPeriod]
==== Reports -> List Participant Involvement In Period

[#ReportsMenu_ListParticipantInvolvementInPeriod Totals]
==== Reports -> List Participant Involvement In Period Totals

[#ReportsMenu_FindVolunteersTimes]
==== Reports -> Find Volunteer's Times

[#ReportsMenu_ListVolunteerInvolvementInPeriod]
==== Reports -> List Volunteer Involvement In Period

[#ReportsMenu_ListVolunteerInvolvementInPeriodTotals]
==== Reports -> List Volunteer Involvement In Period Totals

[#ReportsMenu_FindMostInactiveParticipant]
==== Reports -> Find Most Inactive Participant

[#ReportsMenu_FindParticipantActivity]
==== Reports -> Find Participant Activity

[#ReportsMenu_MailMergeData]
==== Reports -> Mail Merge Data

[#ReportsMenu_FindParticipantsWithBirthdayBetween]
==== Reports -> Find Participants With Birthday Between

[#ChatsDataEntities]
== Chats Data Entities

The following Chats data-model entities are described in sections below:

* <<Person, Persons>>
* <<Activity, Activities>>
** <<One-offActivity, One-off Activities>>
** <<RecurringActivity, Recurring Activities>>
* <<Participant, Participants>>
** <<Participation, Participation>>
** <<Attendance, Attendance>>
* <<Volunteer, Volunteers>>
** <<VolunteeredTime, Volunteered Time>>
* <<ChatsCall, Chats Calls>>

[#Person]
=== Persons

image:https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/dom/src/main/java/au/com/scds/chats/dom/general/Person.png[30,30] 
A Person entity in Chats App holds the contact details, address and some other items relating to a 
specific individual person. A new person is created automatically when a participant or volunteer is 
created. Validation checks are done to see if a person with the same identifying details is present and
if they are linked to an existing participant or volunteer.

The key personal details of firstname, surname, date-of-birth and sex, which are entered at the time of
creation of a new participant (or volunteer), are what are used to identify a unique person. The
contact details and address of the person are displayed and can be updated from their participant
record, along with the other data that is participant related. Other person data is needed but this
described in the <<Administration,Administration>> section.

[#Activity]
=== Activities

Activities are scheduled by Chats Administrators in the Chats App. There are two ways to create an 
Activity, either as a [underline]#One-off Activity# or by first creating a 
[underline]#Recurring Activity# as a 'parent' and then by scheduling 'child' activities off that parent.

When looking at a list of activities from a search, both the one-off and child activities are seen, as
they are basically the same, but have a slightly different icon the 'parented' activities having a 
yellow background 
image:https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/dom/src/main/java/au/com/scds/chats/dom/activity/ParentedActivityEvent.png[20,20]
 (more details below). A separate search for recurring activities is provided.

Activities have child [underline]#participations# and [underline]#attendances#, a participation is
essentially an intention to attend an activity (a 'booking') and an attendance is essentially actual
attendance by the participant at the activity. There are a few reasons for  separating these two, one
reason is that recurring activity parents and children have participations but only children have 
attendances.

[#One-offActivity]
==== One-off Activities 
image:https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/dom/src/main/java/au/com/scds/chats/dom/activity/ActivityEvent.png[30,30] 
These kinds of activities are the base kind, they are created from the 'Activities' menu option 
'Create One-off Activity'. 

Enter a name and a date-time - two mandatory properties. Optionally enter a dfferent DEX 'Case' ID
 (name) for DEX reporting purposes, if you don't one will be created from the mandatory name. DEX Case
  Id has a limit of 30??? characters, but the prompt allows 25.

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/OneoffActivity_GeneralTab.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/OneoffActivity_GeneralTab.png"]

[#RecurringActivity]
==== Recurring Activities
image:https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/dom/src/main/java/au/com/scds/chats/dom/activity/RecurringActivity.png[40,40] 
In the screen capture image below a 'Meet & Make' recurring activity is shown with the 'General' tab
content visible. There are four groups of data items with headings: 'General', 'Scheduling' 'Times'
and 'Location'. Where possible these groups are standardised between entities to aid familiarity.

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/RecurringActivity.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/RecurringActivity.png"]

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/RecurringActivity_ParticipationsTab.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/RecurringActivity_ParticipationsTab.png"]

image:https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/dom/src/main/java/au/com/scds/chats/dom/activity/ParentedActivityEvent.png[40,40]

[#Participant]
=== Participants

[#ParticipantStatus]
==== Participant Status

{What happens when you change Participant status: ACTIVE, INACTIVE, TO-EXIT, EXITED}

[#Participation]
==== Participation

[#Attendance]
==== Attendance

[#Volunteer]
=== Volunteers

[#VolunteerStatus]
==== Volunteer Status

[#VolunteeredTime]
==== Volunteered Time

[#ChatsCall]
=== Chats Calls

[#Reports]
== Reports

Different Chats App report types are described under the <<ReportsMenu, Reports Menu>> section and its different report generation actions/options.

The monthly reporting to the DSS DEX upload site is described in the following Administration / <<DEXAdministration, DSS DEX monthly reporting>> section.

[#Administration]
== Administration

[#RegionnAdministration]
=== Regions

Regions are an important part of the Chats App. Most Chats data entities have an assigned region (SOUTH,
 NORTH, NORTH-WEST) and these values get used to control what data is visible to Chats App users.

The way this happens is through use of a security module installed as an extra "add-on" to the Apache 
Isis framework. Basically the framework determines a 'path' for each entity and compares that calculated
path (essentially the region's name) to a path defined for each App user in the security module. If 
there is a match then the user is allowed to see that entity. See the <<UserAdministration, Users and
Security>> section for more details.

[#PersonAdministration]
=== Persons

[#StatusAdministration]
=== Participant & Volunteer Status

[#UserAdministration]
=== Users and Security

The http://platform.incode.org/modules/spi/security/spi-security.html[Incode Security Module], an 
add-on module for Apache Isis, is used by Chats App. It allows control of Users, Roles and Permissions.
 Chats App also makes use of its 
 http://platform.incode.org/modules/spi/security/spi-security.html#_applicationtenancy_using_paths[Application Tenancy] 
 via "paths" capability to restrict data visibility between Chats regions.

[#DEXAdministration]
=== DSS DEX monthly reporting

Generate XML file on a regional basis for uploading via DEX web portal.
Uploaded files can be rejected if contain invalid data, get an errors file link in response.
Upload file generation finds likely errors and gives a list instead of upload XML file.

==== Mapping Chats data to DEX 'Case', 'Client' and 'Session'

Case = Activity (via DEX Case Id)
Client = Participant (and volunteers via include as Participant)
Session = Activity or a Chats Call (on a day) event

==== Validating Chats data prior to report upload


////

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/activity-menu.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/activity-menu.png"]



image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/recurring-activity-update-general.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/recurring-activity-update-general.png"]

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/participants-menu.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/participants-menu.png"]

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/volunteers-menu.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/volunteers-menu.png"]

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/attendances-menu.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/attendances-menu.png"]

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/calls-menu.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/calls-menu.png"]

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/reports-menu.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/reports-menu.png"]

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/notes-menu.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/notes-menu.png"]

////

[#Installation]
== Installation

The Chats App is a Java based web-application (web-app) built developed on the open-source 
http://isis.apache.org/[Apache Isis (AI)] Java web-application framework. This is a mature project having been developed 
as closed source as the http://www.nakedobjects.org/[Naked Objects] framework for the Irish Social Security Services 
by The Naked Objects Group Ltd which now develops a http://www.nakedobjects.org/[.Net version]. AI is mostly
suited to development of https://www.infoq.com/articles/haywood-ddd-no['sovereign' applications] used by people to perform
their work, as is the case with the Chats App.

AI is well http://isis.apache.org/documentation.html[documented], so there is no need to describe in great detail how it works
in this document, other than to mention that whilst it is based on the Java Servlet Specification, as most Java web-apps
are, the user interface is actually built using a component approach via use of another popular free and open-source framework 
https://wicket.apache.org/[Apache Wicket]. 

As with most web-apps there is a database layer used by the Chats App, in this case https://www.mysql.com/[MySQL]. 
The data mapping between Java objects and the relational data-model is handled by http://www.datanucleus.org/[DataNucleus (DN)].
Apache Isis uses DN exclusively for Object-Relational Mapping (ORM), this is largely due to the two having very
similar approaches, essentially an Aspect-oriented programming paradigm. DN uses byte-code enhancement, whereas AI creates
a run-time metamodel that binds the User-Interface (UI) to the domain model Java objects 
(via AI specific and Java Data Objects (JDO) annotations) and manages their life cycles and persistence.

So while the above may seem a bit complex, installing the Chats App its simply done as its managed by the popular
https://maven.apache.org/[Apache Maven] build system. The process is essentially: (1) Install Java, Development Kit version;
 (2) install Maven; (3) download the Chats App
source from Github and build the Chats App sub-projects contained using Maven; (4) Install a database server (MySQL, with Workbench), and 
(5) Install a Java web-container; (web-server, servlet-container), Apache Tomcat is used; (6) deploy the web-application archive (.war file), created in the 
build, into the web-container; (7) Ensure backups and restores of the database. Each of these steps is now described in the necessary detail:

==== 1. Install latest Java Development Kit (JDK)

You need the full JDK not just the Java Runtime Environment (JRE) [so you can compile Java source to class files,
that then get used by a JRE, one comes with the JDK]. Just get the lastest version, but 1.7 should work too.

Instructions for downloading the Java Development Kit (JDK) Windows Installer are http://www.oracle.com/technetwork/java/javase/downloads/index.html[here]. Note: There are
different editions of the JDK, only the Standard Edition (Java SE) is necessary not the much bigger Enterprise Edition (Java EE).

Testing the installation shouldn't be necessary but at a command prompt type: java -version
----
C:\Users\stevec>java -version
java version "1.8.0_161"
Java(TM) SE Runtime Environment (build 1.8.0_161-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.161-b12, mixed mode)
----

==== 2. Install Apache Maven

Instructions for downloading and installing Maven are https://maven.apache.org/install.html[here].

Testing the installation on my PC by typing: mvn -version

----
C:\Users\stevec>mvn -v
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0
Apache Maven 3.3.3 (7994120775791599e205a5524ec3e0dfe41d4a06; 2015-04-22T21:57:37+10:00)
Maven home: D:\java\apache-maven-3.3.3-bin\apache-maven-3.3.3\bin\..
Java version: 1.8.0_45, vendor: Oracle Corporation
Java home: D:\java\jdk1.8.0_45\jre
Default locale: en_US, platform encoding: Cp1252
OS name: "windows 8.1", version: "6.3", arch: "amd64", family: "dos"
----

Apart from compiling Java source (.java) files to class (.class) files and creating libraries (.jar files) from these
using the installed JDK tools, Maven will also download all the library .jar file dependencies of the project from
online repositories (e.g. https://search.maven.org/[Maven Central]) and allow other tasks to be performed. 

From the command line you can run maven 'phases' and/or 'goals'. A maven 'phase' consists of a logical sequence of 'goals',
which are executable Java code found in 'plugins'. A phase can be executed from the command-line using the command mvn <phase-name>. 
If a specific goal is desired it can be executed using the command format mvn <plugin-name>:<goal-name>.

To do its work Maven first looks for Project Object Model (pom.xml) files in the project folder hierarchy 
and these are included in the Chats App Gthub project downloaded in the next step.

Maven creates a local repository so it doesn't download .jar files it's already obtained, by default on Windows
this is in a .m2 folder in the users home folder.

==== 3. Download and build the Chats App.

The Chats App was intially built from the 'SimpleApp' basic project (called a Maven 'archetype') that is part 
of the AI development effort. Using an archetype gives you the standard Maven folder structure, maven pom file(s) and
source code. The AI 'SimpleApp'archetype is well documented 
http://isis.apache.org/guides/ugfun/ugfun.html#_ugfun_getting-started_simpleapp-archetype[here] 
and the process of building the Chat App is largely the same from http://isis.apache.org/guides/ugfun/ugfun.html#__ugfun_getting-started_simpleapp-archetype_building-the-app[step 5.3]. 

To download the Chats App source from Github you need to get the lastest tagged production release 
(not to 'clone' the whole repository). 
So the home page of the project (which displays this document in HTML form) is
https://github.com/Stephen-Cameron-Data-Services/isis-chats[here] 
and the list of releases is https://github.com/Stephen-Cameron-Data-Services/isis-chats/releases[here].
The current production release is version 1.0 with a title 'Apache Isis 1.13.2 production version'.

image::https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/Github_ProductionRelease.png[link="https://raw.github.com/Stephen-Cameron-Data-Services/isis-chats/master/images/Github_ProductionRelease.png"]

Once you have the downloaded zip archive extracted you should go to the top level 'isis-chats' folder in a command prompt
and run the command: mvn clean install (i.e. first do the 'clean phase' and then the 'install phase') as in the 
SimpleApp documentation http://isis.apache.org/guides/ugfun/ugfun.html#__ugfun_getting-started_simpleapp-archetype_building-the-app[step 5.3].
This builds each of the sub-projects in turn, at the end you should see a message to confirm that each
has been built successfully.

An AI project derived from SimpleApp archetype, once built, should be runnable directly using mvn jetty:run,
as in the SimpleApp example. To do this Maven executes the 'run' goal in the 'jetty' plugin,  which has the effect to
start a basic servlet container (Jetty), and deploy the AI application into it. However, with the Chats App version 1.0 
its not so simple, due to the use of MySQL specific views causing a problem in HSQLDB, the default in-memory database.

So, to test Chats App its necessary (at the moment but not in Chats App v2) to use MySQL as the database engine, see below.

In building the Chats App, the sub-project that is built last is the webapp project. In the folder isis-chats/webapp/target you will
find (after a successful build) the 'chats.war' file. This is what has to be deployed into Tomcat web container.

==== 4. Install MySQL database

The database server that an AI App uses is configurable, it just needs access to a JDBC driver and connection configuration
parameters. However, as mentioned in item 3, the Chats App can only use MySQL because of some database views used for
reports that are MySQL specific. This adds a step to the installation that will be explained at the end of item 5.

Installation of MySQL (the free 'Community Edition') on Windows uses an installer available from https://www.mysql.com/products/community/[here].
You have to get an Oracle account first though.

When running the installer various options are available as to what gets installed, select the Database Server, the JDBC connector and the Workbench.

Once you have an installation completed, using the MySQL Workbench, its a simple task to create a new schema called 'chats' and a new user also called
'chats' with password of your choice and to give that new chats user all rights to the chats schema. This will allow all the tables and
constraints to be created automatically in the chats schema when the Chats App starts for the first time (in step 6) and connects to MySQL. On subsequent restarts
it finds they are all present and doesn't change anything.

In the case of having to restore the Chats database from an export file, an import can be done at this stage. See the section <<BackupAndRestore, Backup and Restore>>

You have set up a MySQL database server in preparation for the Chats App to connect to it, running as a Windows Service.

==== 5. Install Apache Tomcat web server

There are several free Java web-containers, Jetty mentioned above is light-weight and mainly used for testing, for production in the 
case of Chats App we use Apache Tomcat, downloads are http://tomcat.apache.org/[here]. 

Installation is just to extract a zip archive. Both Apache Tomcat and AI will need a minimum version of 
Java to run. Apache Tomcat 8, Apache Isis 1.13.2, Java 1.7 is the current combination. 

The key to running Apache Tomcat on Windows is to create a Windows Service to start and stop Tomcat when the server is 
started and stopped. This is done with an separate intaller that is also available from the download site.

One way to test Apache Tomcat is to try its default administrator web-app. This requires an admin login which has to
be enabled in configuration file. See the Tomcat installation docs for how to do that.

Also important is ensure that with a Windows server shutdown and restart, that the MySQL and Tomcat services start in the correct order.
MySQL has to be ready to accept connections from the Chats App when Tomcat Service restarts. This is done in the configuration
of the Tomcat Service making it dependant on the MySQL Service (I recall???).

==== 6. Deploy the Chats App web-app into Tomcat

There are two ways to deploy a .war file into Tomcat, via the admin web-app web-page or by moving it into the 
webapp folder in the Tomcat intallation. Tomcat scans this folder for new .war files and on finding one it
extracts it (they are actually zip archives) and deploys the contents as a new site, usually with a url root  
the same name as the .war file, so in this case 'chats'. 

So after deploying the chats.war you can test the url http://localhost:8080/chats[http://localhost:8080/chats] 
but there will be a problem in the first instance due to the need to configure the JDBC connection properly in the
Apache Isis configuration files. 

By deployng the .war the config files can then be easily found in the standard place, the chats/WEB-INF folder. 
You'll see a few configuration related files there, web.xml is the standard one used by all Java web-containers, 
the others are Apache Isis related. Open persistor.properties and look for the following lines:

----
#
# JDBC connection details
# (also update the pom.xml to reference the appropriate JDBC driver)
#

#
# SC added MySQL 
#
isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionDriverName=com.mysql.jdbc.Driver
isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionURL=jdbc:mysql://localhost:3306/chats?zeroDateTimeBehavior=convertToNull
isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionUserName=chats
isis.persistor.datanucleus.impl.javax.jdo.option.ConnectionPassword=password
----

The four uncommented lined are the parameters that Apache Isis uses to make a JDBC connection to the database. 
They are obviously key-value pairs. The first is the name of a Java connection 'driver' class, more on that in the
 next paragraph. The second is a connection URL that the driver uses to make the connection to the database, the first 
section indicating the kind of database server (jdbc:mysql), then the http host and port (//localhost:3306), then the
MySQL parameters of schema-name (/chats) and a specific configuration of how to handle date-times 
(?zeroDateTimeBehavior=convertToNull). The third and forth are the database user name and password created in step 4 above.

There is one more thing to do to enable the connection of Chats App to the MySQL database, which is to move the
MySQL JDBC driver/connector from the location of the Chats specific libraries (from chats.war), which is 
mysql-connector-java-X.X.X.jar in the folder webapps/chats/WEB-INF/lib/, into the shared lib/ folder at the top level of
the Tomcat intall location. I think the need for this is may be due to Tomcat actually holding the database connections.

Once this configuration step is completed restart the Tomcat service, or else use the Tomcat admin web-app page 
(if enabled) to just start the chats 'context'. If the chats app is then still not available,  its usually
necessary to check the tomcat logs in the top level logs/ folder for error messages to figure out why.

[#BackupAndRestore]
== Backup and Restore

The Chats App MySQL database can be recovered from exports made on a nightly basis and saved to tape. 

Exports to file and Imports from file can either be done from the command-line or from the MySQL Workbench Client App 
installed in step 4. 

To create the nightly exports, a Windows batch file is executed by the Windows Scheduler each night at 6:00pm.
These exported 'dump' files get saved to tape. The last 20 such export files are on the server as the batch file also removes any files older 
than 20 days in the export folder location.

Doing an data import from the lastest export file is easily done using the MySQL Workbench Client, from the top menu 
select Server -> Data Import then select the exported 'dump' file to import. It shouldn't be necessary to create the chats schema
first but doesn't seem to matter if you have already. The import will create all tables and views present in the database schema exported.






